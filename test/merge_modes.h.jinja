// WARNING: This file was auto-generated by: {{ script }}
#include "evdev-scancodes.h"
#include <xkbcommon/xkbcommon.h>

#include "src/utils.h"
#include "test.h"

{% macro make_test(type) -%}
    const char keymap_{{ type }}[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"basic\" };\n"
        "  xkb_symbols { include \"pc+{{symbols_file}}(base)
        {{- '|' if type == 'augment' else '+' -}}
        {{symbols_file}}(new)\" };"
        "};";
    fprintf(stderr, "*** test_merge_modes: {{ type }} ***\n");
    keymap = test_compile_buffer(ctx, keymap_{{type}},
                                 ARRAY_SIZE(keymap_{{type}}));
    assert(test_key_seq(keymap,
        {%- for entry in tests +%}
        {{ entry.key.c }}, BOTH, {{ entry[type].levels[0].keysyms_c }}, {%
            if entry[type].levels|length > 1 -%}
        NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        {{ entry.key.c }}, BOTH, {{ entry[type].levels[1].keysyms_c }}, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L,
        {%- endif %}{% if not loop.last %} NEXT,{% endif %}
        {% endfor %} FINISH
    ));
    xkb_keymap_unref(keymap);
{%- endmacro %}

static void
test_merge_modes(struct xkb_context *ctx)
{
    struct xkb_keymap *keymap;

    /* Mode: Augment */
    {{ make_test("augment") }}

    /* Mode: Override */
    {{ make_test("override") }}
}
