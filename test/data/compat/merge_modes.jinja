// WARNING: This file was auto-generated by: {{ script }}
default xkb_compatibility "base" {

	virtual_modifiers NumLock;

	interpret.repeat= False;
	setMods.clearLocks= True;
	latchMods.clearLocks= True;
	latchMods.latchToLock= True;

	interpret Any + Any {
		action= SetMods(modifiers=modMapMods);
	};

	interpret Caps_Lock {
		action = LockMods(modifiers = Lock);
	};

	indicator "Caps Lock" {
	!allowExplicit;
	whichModState= Locked;
	modifiers= Lock;
	};

	indicator "Num Lock" {
	!allowExplicit;
	whichModState= Locked;
	modifiers= NumLock;
	};
};

{% macro make_update(name, mode, local) -%}
xkb_compat "{{ name }}{{ "-" + mode if local else "" }}" {
{% set mode = mode + " " if local and mode != "default" else "" %}
	{% if local %}
	include "{{ filename }}(base)"

	{% endif %}
	{{ mode }}virtual_modifiers NumLock;

	{{ mode }}interpret.repeat= False;
	{{ mode }}setMods.clearLocks= False; // Changed

	// Unchanged
	{{ mode }}interpret Any + Any {
		action= SetMods(modifiers=modMapMods);
	};

	// Changed
	{{ mode }}interpret Caps_Lock {
		action = LockMods(modifiers = NumLock);
	};

	 // Unchanged
	{{ mode }}indicator "Caps Lock" {
		!allowExplicit;
		whichModState= Locked;
		modifiers= Lock;
	};

	// Changed
	{{ mode }}indicator "Num Lock" {
		!allowExplicit;
		whichModState= Base;
		modifiers= Lock;
	};

	// New
	{{ mode }}indicator "Kana" {
		!allowExplicit;
		whichModState= Locked;
		modifiers= Control;
	};
};
{% endmacro %}

{{ make_update("new", "update", false) }}
{{ make_update("new", "default", true) }}
{{ make_update("new", "augment", true) }}
{{ make_update("new", "override", true) }}
{{ make_update("new", "replace", true) }}

xkb_compat "default" {
{% macro make_override() %}
	virtual_modifiers NumLock;

	interpret.repeat= False;
	setMods.clearLocks= False;
	interpret Caps_Lock+AnyOfOrNone(all) {
		action= LockMods(modifiers=NumLock);
	};
	interpret Any+AnyOf(all) {
		action= SetMods(modifiers=modMapMods);
	};
	indicator "Caps Lock" {
		whichModState= locked;
		modifiers= Lock;
	};
	indicator "Kana" {
		whichModState= locked;
		modifiers= Control;
	};
	indicator "Num Lock" {
		whichModState= base;
		modifiers= Lock;
	};
{%- endmacro %}
{{ make_override() }}
};

xkb_compat "augment" {
	virtual_modifiers NumLock;

	interpret.useModMapMods= AnyLevel;
	interpret.repeat= False;
	interpret Caps_Lock+AnyOfOrNone(all) {
		action= LockMods(modifiers=Lock);
	};
	interpret Any+AnyOf(all) {
		action= SetMods(modifiers=modMapMods,clearLocks);
	};
	indicator "Caps Lock" {
		whichModState= locked;
		modifiers= Lock;
	};
	indicator "Num Lock" {
		whichModState= locked;
		modifiers= NumLock;
	};
	indicator "Kana" {
		whichModState= locked;
		modifiers= Control;
	};
};

xkb_compat "override" {
{{ make_override() }}
};

xkb_compat "replace" {
{{ make_override() }}
};
