// WARNING: This file was auto-generated by: scripts/update-symbols-tests.py
#include "evdev-scancodes.h"
#include <xkbcommon/xkbcommon.h>

#include "src/utils.h"
#include "test.h"

static void
test_merge_modes(struct xkb_context *ctx)
{
    struct xkb_keymap *keymap;

    /****************************************************************
     * Test group: keysyms_only
     ****************************************************************/

    /* Mode: Augment */
    const char keymap_keysyms_only_augment[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(keysyms_only_base)\"\n"
        "    augment \"merge_modes(keysyms_only_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: keysyms_only, augment ***\n");
    keymap = test_compile_buffer(ctx, keymap_keysyms_only_augment,
                                 ARRAY_SIZE(keymap_keysyms_only_augment));
    assert(test_key_seq(keymap,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_R, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_R, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_T, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_T, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Y, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Y, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_U, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_U, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_I, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_I, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_G, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_G, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_H, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_H, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_J, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_J, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_K, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_K, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_L, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_L, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_X, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_X, BOTH, XKB_KEY_NoSymbol, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_C, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_C, BOTH, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_V, BOTH, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_V, BOTH, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_B, BOTH, XKB_KEY_a, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_B, BOTH, XKB_KEY_Greek_XI, XKB_KEY_B, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_N, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_N, BOTH, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_M, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_M, BOTH, XKB_KEY_X, XKB_KEY_B, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, XKB_KEY_Greek_xi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, BOTH, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, BOTH, XKB_KEY_X, XKB_KEY_NoSymbol, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_RO, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_RO, BOTH, XKB_KEY_X, XKB_KEY_NoSymbol, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, BOTH, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, BOTH, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, BOTH, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, BOTH, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, BOTH, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, BOTH, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /* Mode: Override */
    const char keymap_keysyms_only_override[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(keysyms_only_base)\"\n"
        "    override \"merge_modes(keysyms_only_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: keysyms_only, override ***\n");
    keymap = test_compile_buffer(ctx, keymap_keysyms_only_override,
                                 ARRAY_SIZE(keymap_keysyms_only_override));
    assert(test_key_seq(keymap,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_R, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_R, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_T, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_T, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Y, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Y, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_U, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_U, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_I, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_I, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_G, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_G, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_H, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_H, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_J, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_J, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_K, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_K, BOTH, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_L, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_L, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_X, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_X, BOTH, XKB_KEY_NoSymbol, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_C, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_C, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_V, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_V, BOTH, XKB_KEY_NoSymbol, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_B, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_B, BOTH, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_N, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_N, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_M, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_M, BOTH, XKB_KEY_X, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, XKB_KEY_Greek_xi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, BOTH, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, BOTH, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, BOTH, XKB_KEY_X, XKB_KEY_NoSymbol, XKB_KEY_A, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_RO, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, XKB_KEY_Greek_xi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_RO, BOTH, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, BOTH, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, BOTH, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, BOTH, XKB_KEY_Greek_alpha, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, BOTH, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, BOTH, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, BOTH, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /****************************************************************
     * Test group: actions_only
     ****************************************************************/

    /* Mode: Augment */
    const char keymap_actions_only_augment[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(actions_only_base)\"\n"
        "    augment \"merge_modes(actions_only_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: actions_only, augment ***\n");
    keymap = test_compile_buffer(ctx, keymap_actions_only_augment,
                                 ARRAY_SIZE(keymap_actions_only_augment));
    assert(test_key_seq(keymap,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_W, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_W, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_E, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_E, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_R, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_R, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_Y, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_Y, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_U, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_U, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_I, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_I, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_A, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_A, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_S, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_S, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_D, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_D, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_F, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_F, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_H, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_H, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_J, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_J, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_K, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_K, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_L, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_L, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Z, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_Z, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_X, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_X, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_C, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_C, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_V, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_V, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_B, UP, XKB_KEY_Ukrainian_yi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_B, UP, XKB_KEY_Ukrainian_YI, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_N, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_N, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_M, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_M, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_RO, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_RO, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_GRAVE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_1, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_1, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_3, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_3, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_4, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_4, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_5, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_5, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /* Mode: Override */
    const char keymap_actions_only_override[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(actions_only_base)\"\n"
        "    override \"merge_modes(actions_only_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: actions_only, override ***\n");
    keymap = test_compile_buffer(ctx, keymap_actions_only_override,
                                 ARRAY_SIZE(keymap_actions_only_override));
    assert(test_key_seq(keymap,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_W, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_W, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_E, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_E, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_R, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_R, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_Y, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_Y, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_U, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_U, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_I, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_I, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_A, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_A, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_S, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_S, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_D, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_D, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_F, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_F, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_H, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_H, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_J, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_J, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_K, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_K, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_L, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_L, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Z, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_Z, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_X, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_X, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_C, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_C, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_V, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_V, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_B, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_B, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_N, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_N, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_M, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_M, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_RO, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_RO, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_GRAVE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_1, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_1, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_3, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_3, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_4, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_4, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_5, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_5, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_6, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_6, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /****************************************************************
     * Test group: keysyms_and_actions_auto
     ****************************************************************/

    /* Mode: Augment */
    const char keymap_keysyms_and_actions_auto_augment[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(keysyms_and_actions_auto_base)\"\n"
        "    augment \"merge_modes(keysyms_and_actions_auto_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: keysyms_and_actions_auto, augment ***\n");
    keymap = test_compile_buffer(ctx, keymap_keysyms_and_actions_auto_augment,
                                 ARRAY_SIZE(keymap_keysyms_and_actions_auto_augment));
    assert(test_key_seq(keymap,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_W, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_W, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_E, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_E, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_R, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_R, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_a, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_A, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_a, NEXT,
        KEY_Y, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_A, NEXT,
        KEY_Y, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_a, NEXT,
        KEY_U, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_A, NEXT,
        KEY_U, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_a, NEXT,
        KEY_I, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_A, NEXT,
        KEY_I, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_A, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_A, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_S, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_S, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_D, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_D, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_F, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_F, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_H, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_H, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_a, NEXT,
        KEY_J, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_A, NEXT,
        KEY_J, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_a, NEXT,
        KEY_K, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_A, NEXT,
        KEY_K, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_a, NEXT,
        KEY_L, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_A, NEXT,
        KEY_L, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_a, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_A, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_a, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_A, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_a, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_A, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Z, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_Z, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_X, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_NoSymbol, XKB_KEY_Greek_BETA, NEXT,
        KEY_X, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_C, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_C, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_V, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_V, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_a, XKB_KEY_Greek_upsilon, NEXT,
        KEY_B, UP, XKB_KEY_Ukrainian_yi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_Greek_XI, XKB_KEY_B, NEXT,
        KEY_B, UP, XKB_KEY_Ukrainian_YI, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_N, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_N, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_M, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_X, XKB_KEY_B, NEXT,
        KEY_M, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, XKB_KEY_Greek_xi, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_X, XKB_KEY_NoSymbol, XKB_KEY_A, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_RO, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_X, XKB_KEY_NoSymbol, XKB_KEY_A, NEXT,
        KEY_RO, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, DOWN, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_GRAVE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_1, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_1, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_3, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_3, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_a, NEXT,
        KEY_4, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_4, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_5, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_5, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_a, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /* Mode: Override */
    const char keymap_keysyms_and_actions_auto_override[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(keysyms_and_actions_auto_base)\"\n"
        "    override \"merge_modes(keysyms_and_actions_auto_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: keysyms_and_actions_auto, override ***\n");
    keymap = test_compile_buffer(ctx, keymap_keysyms_and_actions_auto_override,
                                 ARRAY_SIZE(keymap_keysyms_and_actions_auto_override));
    assert(test_key_seq(keymap,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Q, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_W, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_W, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_W, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_E, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_E, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_E, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_R, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_R, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_R, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_a, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_T, DOWN, XKB_KEY_A, NEXT,
        KEY_T, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_Y, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Y, DOWN, XKB_KEY_A, NEXT,
        KEY_Y, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_a, NEXT,
        KEY_U, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_U, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_U, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_I, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_I, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_I, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_A, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_A, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_A, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_S, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_S, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_S, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_D, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_D, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_D, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_F, BOTH, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_F, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_F, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_G, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_G, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_H, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_H, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_H, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_J, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_J, DOWN, XKB_KEY_A, NEXT,
        KEY_J, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_K, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_K, DOWN, XKB_KEY_A, NEXT,
        KEY_K, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_a, NEXT,
        KEY_L, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_L, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_L, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_a, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SEMICOLON, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_SEMICOLON, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_APOSTROPHE, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_NoSymbol, NEXT,
        KEY_APOSTROPHE, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_BACKSLASH, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_BACKSLASH, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_Z, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_Z, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_Z, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_X, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_X, DOWN, XKB_KEY_NoSymbol, XKB_KEY_Greek_BETA, NEXT,
        KEY_X, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_C, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_C, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_C, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, NEXT,
        KEY_V, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_V, DOWN, XKB_KEY_NoSymbol, XKB_KEY_Greek_BETA, NEXT,
        KEY_V, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_B, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_B, DOWN, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_B, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_N, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_N, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_N, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_y, NEXT,
        KEY_M, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_M, DOWN, XKB_KEY_X, XKB_KEY_Greek_BETA, NEXT,
        KEY_M, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_COMMA, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, XKB_KEY_Greek_xi, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_DOT, DOWN, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_DOT, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_SLASH, DOWN, XKB_KEY_X, XKB_KEY_NoSymbol, XKB_KEY_A, NEXT,
        KEY_SLASH, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_NoSymbol, XKB_KEY_Greek_xi, NEXT,
        KEY_RO, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_RO, DOWN, XKB_KEY_Greek_XI, XKB_KEY_Greek_BETA, NEXT,
        KEY_RO, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, BOTH, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, DOWN, XKB_KEY_A, XKB_KEY_Y, NEXT,
        KEY_GRAVE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_1, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_1, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_a, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_B, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_Greek_alpha, NEXT,
        KEY_3, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_3, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_4, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_Greek_ALPHA, XKB_KEY_Greek_UPSILON, NEXT,
        KEY_4, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_5, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_5, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_Greek_alpha, XKB_KEY_Greek_upsilon, NEXT,
        KEY_6, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_Greek_ALPHA, NEXT,
        KEY_6, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /****************************************************************
     * Test group: keysyms_and_actions_extras
     ****************************************************************/

    /* Mode: Augment */
    const char keymap_keysyms_and_actions_extras_augment[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(keysyms_and_actions_extras_base)\"\n"
        "    augment \"merge_modes(keysyms_and_actions_extras_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: keysyms_and_actions_extras, augment ***\n");
    keymap = test_compile_buffer(ctx, keymap_keysyms_and_actions_extras_augment,
                                 ARRAY_SIZE(keymap_keysyms_and_actions_extras_augment));
    assert(test_key_seq(keymap,
        KEY_GRAVE, DOWN, XKB_KEY_a, NEXT,
        KEY_GRAVE, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, DOWN, XKB_KEY_X, NEXT,
        KEY_GRAVE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, BOTH, XKB_KEY_a, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_1, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, BOTH, XKB_KEY_a, XKB_KEY_b, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_a, XKB_KEY_b, NEXT,
        KEY_3, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_3, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_4, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_4, UP, XKB_KEY_Ukrainian_YI, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_a, XKB_KEY_b, NEXT,
        KEY_5, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_5, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_a, XKB_KEY_b, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_A, XKB_KEY_B, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_7, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_7, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_7, DOWN, XKB_KEY_A, XKB_KEY_B, NEXT,
        KEY_7, UP, XKB_KEY_Ukrainian_YI, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_8, DOWN, XKB_KEY_a, XKB_KEY_b, NEXT,
        KEY_8, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_8, DOWN, XKB_KEY_X, XKB_KEY_B, NEXT,
        KEY_8, UP, XKB_KEY_Ukrainian_YI, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_9, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_9, UP, XKB_KEY_Ukrainian_yi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_9, DOWN, XKB_KEY_X, XKB_KEY_B, NEXT,
        KEY_9, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);

    /* Mode: Override */
    const char keymap_keysyms_and_actions_extras_override[] =
        "xkb_keymap {\n"
        "  xkb_keycodes { include \"evdev\" };\n"
        "  xkb_types { include \"complete\" };\n"
        "  xkb_compat { include \"complete\" };\n"
        "  xkb_symbols {\n"
        // NOTE: Separate statements so that *all* the merge modes *really* work.
        //       Using + and | separators downgrades `replace key` to `override/
        //       augment key`.
        "    include \"pc\"\n"
        "    include \"merge_modes(keysyms_and_actions_extras_base)\"\n"
        "    override \"merge_modes(keysyms_and_actions_extras_new)\"\n"
        "    include \"merge_modes(group2):2+merge_modes(group3):3\"\n"
        "  };\n"
        "};";
    fprintf(stderr, "*** test_merge_modes: keysyms_and_actions_extras, override ***\n");
    keymap = test_compile_buffer(ctx, keymap_keysyms_and_actions_extras_override,
                                 ARRAY_SIZE(keymap_keysyms_and_actions_extras_override));
    assert(test_key_seq(keymap,
        KEY_GRAVE, DOWN, XKB_KEY_a, NEXT,
        KEY_GRAVE, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_GRAVE, DOWN, XKB_KEY_X, NEXT,
        KEY_GRAVE, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_1, DOWN, XKB_KEY_NoSymbol, XKB_KEY_NoSymbol, NEXT,
        KEY_1, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_1, BOTH, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_2, DOWN, XKB_KEY_NoSymbol, NEXT,
        KEY_2, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_2, BOTH, XKB_KEY_X, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_a, XKB_KEY_b, NEXT,
        KEY_3, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_3, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_3, UP, XKB_KEY_Ukrainian_I, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_x, XKB_KEY_y, NEXT,
        KEY_4, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_4, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_4, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_x, XKB_KEY_b, NEXT,
        KEY_5, UP, XKB_KEY_dead_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_5, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_5, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_x, XKB_KEY_b, NEXT,
        KEY_6, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_6, DOWN, XKB_KEY_A, XKB_KEY_B, NEXT,
        KEY_6, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_7, DOWN, XKB_KEY_x, XKB_KEY_y, NEXT,
        KEY_7, UP, XKB_KEY_Ukrainian_i, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_7, DOWN, XKB_KEY_A, XKB_KEY_B, NEXT,
        KEY_7, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_8, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_8, UP, XKB_KEY_schwa, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_8, DOWN, XKB_KEY_X, XKB_KEY_Y, NEXT,
        KEY_8, UP, XKB_KEY_dead_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, NEXT,
        KEY_9, DOWN, XKB_KEY_a, XKB_KEY_y, NEXT,
        KEY_9, UP, XKB_KEY_Ukrainian_yi, NEXT,
        KEY_LEFTSHIFT, DOWN, XKB_KEY_Shift_L, NEXT,
        KEY_9, DOWN, XKB_KEY_X, XKB_KEY_B, NEXT,
        KEY_9, UP, XKB_KEY_SCHWA, NEXT,
        KEY_LEFTSHIFT, UP, XKB_KEY_Shift_L, FINISH
    ));
    xkb_keymap_unref(keymap);
}
